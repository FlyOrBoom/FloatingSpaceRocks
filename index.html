
<!doctype html>
<html lang='en-us'>
  <head>
    <title>Space Rocks | FTC 15303</title>
    <meta charset='utf-8'>
    <meta name='description' content='A robotics team based in southern California. Part of MajorStem.org and sponsored by Collins Aerospace.'>
    <meta name="keywords" content="15303,space rocks,15303 space rocks,FIRST,FTC,robotics">
    <meta name='viewpoint' content='width=device-width, initial-scale=1'>
    <link rel="shortcut icon" href="fav.png">
    <link rel="prefetch" href='http://majorstem.org/index.php/feed'>
    <style>
@font-face{
  font-family:'hyperspace';
  src: url('fonts/hyperspace/regular.otf');
}
html,body{
  margin:0;
  background:#000;
  overflow:hidden;
  width:100vw;
  height:100%;
}
@keyframes hue{
  0%{filter:hue-rotate(0)}
  100%{filter:hue-rotate(360deg)}
}
#logo-wrapper{
  position:relative;
  width:99vmin;
  height:110vmin;
  left:calc(50vw - 50vmin);
  top:calc(50% - 50vmin);
}
@media(inverted-colors:inverted){
  body{
    filter:invert(1) hue-rotate(180deg);
  }
}
#logo-wrapper,#cursor,path#wire0{
  stroke-width:.8vmin;
}
#directory{
  width:calc(100vw - 2vmin);
  height:calc(100% - 2vmin);
  position:fixed;
  left:1vmin;
  top:1vmin;
  pointer-events:none;
  z-index:99;
  mix-blend-mode:lighten;
  font-family:hyperspace,sans-serif;
  font-size:calc(4vmax + 2vmin + .5rem);
}
#directory,#logo-wrapper,#arcade{
  color:#fff;
  filter:drop-shadow(0 0 .1vmin #aaf) drop-shadow(0 0 .4vmin #88f) drop-shadow(0 0 1.6vmin #44f8);
}
#directory>a{
  text-decoration:none;
  color:inherit;
  display:block;
  padding-left:calc(.1*(4vmax + 2vmin + .2rem));
  position:absolute;
  pointer-events:auto;
  user-select:none;
  cursor:inherit;
}
#directory>a:hover,#directory>a:focus{
  outline:.15rem solid #fff;
}
#directory>#robot{
  bottom:0;
}
#directory>#blog{
  right:0;
}
#directory>#git{
  right:0;
  bottom:0;
}
#arcade{
  position:absolute;
  top:0;
  left:0;
  width:100vw;
  height:100vh;
  pointer-events:none;
  mix-blend-mode:lighten;
}
#cursor{
  position:absolute;
  left:0;
  top:0;
  z-index:199;
  width:32px;
  height:32px;
  transform-origin:11.1px 18.5px;
}
.beam{
  position:absolute;
  left:0;
  bottom:0;
  z-index:189;
  height:.3vmin;
  background-image:linear-gradient(270deg,#fff,#fff0 128px);
  transform-origin:left;
  animation:2s fire forwards linear;
  border-radius:.15vmin;
}
@keyframes fire{
  0%{width:5px}
  99%{width:200vmax}
  100%{display:none}
}
#asteroids{
  left:0;
  top:0;
  width:100vmax;
  height:100vmax;
  display:none;
}
#divvy{
  position:absolute;
  top:0;
  width:100vw;
  height:100vh;
}
.hitAsteroid{
  animation:.1s hitAsteroid forwards;
}
@keyframes hitAsteroid{
  0%{fill:#fff}
  99%{opacity:0;fill:#fff}
  100%{opacity:0}
}
    </style>
  </head>
  <body>
    <div id='directory'>
      <a id='about' href='about'>About us</a>
      <a id='robot' href='robot'>robot</a>
      <a id='blog' href='blog'>blog</a>
      <a id='git' target='_blank' href='https://github.com/15303'>github</a>
    </div>
      <svg id='logo-wrapper' viewBox='0 0 1800 2000' stroke-linecap='round' fill='none' stroke='#fff'>
        <path id='wirex' d='
        M900 500l500 500l-500 500l-500 -500z
        '/>
        <path id='wire0' d='
        M900 500l500 500l-500 500l-500 -500z
        '/>
        <path id='wire1' d='
        M400 1000l600 -100l400 100l-600 100z
        '/>
        <ellipse cx='900' cy='1000' rx='500' ry='100'/>
        <path id='wire2'/>
        <!--<path id='wire2' d='-->
        <!--M900 500l100 400l-100 600l-100 -400z-->
        <!--'/>-->
        <path id='logo' d='
    M682.5 667.5l-150 -150v50v-50z
    M707.5 642.5l100 -100l-50 -100l-125 125l-75 -75l150 -150
    M832.5 517.5l50 -50v-150l-100 100l100 -100v-150l-150 150
    M917.5 467.5l82.5 82.5l100 -200l-182.5 -182.5z
    M1025 575l100 100l75 -75l-125 -125l125 125l75 -75l-150 -150
    
    M450 1100l-75 -75l-75 75l75 75l-75 75l-75 -75
    M475 1125l-150 150l150 -150l75 75l-75 75l-75 -75
    M632.5 1267.5h-100l-107.5 107.5l77.5 -75l100 100l-75 75l107.5 -107.5v-100
    M775 1425l-75 -75l-150 150l75 75
    M875 1525l-75 -75l-75 75l50 50l-50 -50l-75 75l75 75
    
    M925 1525l150 150l-150 -150l75 -75l75 75l-75 75h150
    M1125 1325l-100 100l150 150l100 -100z
    M1225 1225l-75 75l150 150l75 -75
    M1250 1200l150 150l-75 -75h150h-150v-150
    M1425 1025l-75 75l75 75l75 -75l75 75l-75 75
        '/>
      </svg>
    <div id='divvy' onclick='enterGame()'></div>
    <div id='arcade'>
      <svg id='cursor' viewBox='0 0 128 128'>
        <path d='M107.923 64L4 4v120L44.415 74z' fill='none' stroke='#fff'/>
      </svg>
      <div id='beamWrapper'></div>
      <svg id='asteroids' viewBox='0 0 1000 1000' fill='none' stroke='#fff'>
      </svg>
    </div>
    <!--<div id='indicator' style='position:absolute;width:5px;height:5px;background-color:#f00'></div>-->
    <script>
const doc = document,
      ref = doc.referrer,
      logoWrapper = doc.getElementById('logo-wrapper'),
      wire = [doc.getElementById('wire0'),doc.getElementById('wire1'),doc.getElementById('wire2')],
      beamWrapper = doc.getElementById('beamWrapper'),
      cursor = doc.getElementById('cursor'),
      asteroids = doc.getElementById('asteroids'),
      directory = doc.getElementById('directory');
let beam,animateTick = 0,asteroidTick=0;
doc.body.style.cursor='none';
disappear();
cursor.angle = 120;
requestUpdate();
wire.time = Date.now();
var proto;
doc.onmousemove = function(e){
  cursor.xcoord = e.pageX;
  cursor.ycoord = e.pageY;
};
doc.onkeyup = function(e){
  if(e.code==='Space'){
    enterGame();
  }
};
function enterGame(){
  if(logoWrapper.style.display!=='none'){

    addAsteroid();
    doc.onkeydown = function(e){
      switch(e.code){
        case 'ArrowLeft':
          cursor.angle-=6;
          break;
        case 'ArrowRight':
          cursor.angle+=6;
          break;
        case 'KeyA':
          cursor.angle-=6;
          break;
        case 'KeyD':
          cursor.angle+=6;
          break;
      }
      requestUpdate();
    };
    doc.onwheel = function(e){
      if(e.deltaY>0){
        cursor.angle-=Math.ceil(e.deltaY/8);
      }else{
        cursor.angle-=Math.floor(e.deltaY/8);
      }
      requestUpdate();
    };
    doc.onkeyup = function(e){
      if(e.code==='Space'||e.code==='ArrowUp'||e.code==='KeyW'){
        shoot();
      }
    };
    doc.onmousedown = function(){
      shoot();
    };
    window.onmouseout = function(){
      disappear();
    };
    logoWrapper.style.display='none';
  }
}
function shoot(){
  beam = doc.createElement('div');
  beam.classList = 'beam';
  beam.xstart = cursor.xcoord;
  beam.ystart = cursor.ycoord;
  beam.style.left=(beam.xstart)+'px';
  beam.style.top=(beam.ystart)+'px';
  beam.style.transform = 'rotate('+(-cursor.angle)+'deg)';
  beam.style.display='block';
  beamWrapper.appendChild(beam);
  
  beam.angle = cursor.angle/180*Math.PI;
  beam.time = Date.now();
  beam.max = 2*Math.max(window.innerWidth,window.innerHeight);
  
  let hitChecker = setInterval(function(){
    beam.elapsed = (Date.now() - beam.time)/2000;
    beam.xcoord = beam.elapsed*beam.max*Math.cos(beam.angle)+beam.xstart;
    beam.ycoord = -beam.elapsed*beam.max*Math.sin(beam.angle)+beam.ystart;
    
  // doc.getElementById('indicator').style.transform='translate('+proto.pathcoords[0][0]+'px,'+proto.pathcoords[0][1]+'px)';
    
    if(inside([beam.xcoord,beam.ycoord],proto.pathcoords)){
      clearInterval(hitChecker);
      doc.getElementById('asteroid'+asteroidTick).classList.add('hitAsteroid');
      beam.style.display='none';
      addAsteroid();
      setTimeout(function(){asteroids.removeChild(asteroids.firstElementChild)},200)
    }
    
  },5);
  setTimeout(function(){beamWrapper.removeChild(beamWrapper.firstElementChild);clearInterval(hitChecker)},1500);
  
}
function requestUpdate(){
  window.requestAnimationFrame(cursorMove);
}
function cursorMove(){
  cursor.style.transform='translate('+cursor.xcoord+'px,'+cursor.ycoord+'px) rotate('+(-cursor.angle+120)+'deg)';
  requestUpdate();
}
function wire3D(){
  wire.tick = Date.now() - wire.time;
  wire.center = [900,1000];
  wire[2].setAttribute('d','M'+(Math.cos(tick)+wire.center[0])+' 500'+'L1000 900L900 1500L800 1100z');
}
setInterval(wire3D(),500);
function disappear(){
  cursor.style.transform='translate(-64px,-64px)';
}
function addAsteroid(){
  // let proto=`<path id='asteroid`+asteroidTick+`' d='M`+Math.random()*1000+` `+(Math.round(Math.random())*2000-500)+`l`;
  asteroidTick++;
  let scaler = Math.max(window.innerWidth,window.innerHeight)/1000;
  proto={
    ycoord:400*Math.random()+100,
    xcoord:800*Math.random()+100,
  };
  proto.path=`<path class='asteroid' id='asteroid`+asteroidTick+`' d='M`+proto.xcoord+` `+proto.ycoord+`L`;
  proto.pathcoords=[[proto.xcoord*scaler,proto.ycoord*scaler]];
  for(let i = 0;i<19;i++){
    proto.coord=Math.random()*20;
    proto.i=Math.PI*i/10.5;
    if(i%2){
      proto.ycoord+=3*Math.round(proto.coord*Math.sin(proto.i));
      proto.pathcoords.push([proto.xcoord*scaler,proto.ycoord*scaler]);
      proto.path+=(proto.ycoord+'L');
    }else{
      proto.xcoord+=3*Math.round(proto.coord*Math.cos(proto.i));
      proto.path+=(proto.xcoord+' ');
    }
  }
  proto.path+=(proto.pathcoords[0][1]+`Z'/>`);
  proto.pathcoords[9][1] = 300;
  asteroids.style.display='block';
  asteroids.innerHTML+=proto.path;
}
function inside(point, vs) {
  // ray-casting algorithm based on
  // http://www.ecse.rpi.edu/Homepages/wrf/Research/Short_Notes/pnpoly.html

  let x = point[0], y = point[1];

  let inside = false;
  for (let i = 0, j = vs.length - 1; i < vs.length; j = i++) {
    let xi = vs[i][0], yi = vs[i][1];
    let xj = vs[j][0], yj = vs[j][1];

    let intersect = ((yi > y) != (yj > y))
        && (x < (xj - xi) * (y - yi) / (yj - yi) + xi);
    if (intersect) inside = !inside;
  }

  return inside;
};

    </script>
  </body>
</html>